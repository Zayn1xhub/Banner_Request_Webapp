<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>ZAYN1x — Request Custom Banner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <style>
        :root { --bg:#0f172a; --glass: rgba(255,255,255,0.03); }
        body { background-color: var(--bg); color: white; font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif; }
        .glass { background: var(--glass); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.06); }
        input[type='range']::-webkit-slider-thumb { -webkit-appearance: none; width:22px; height:22px; background:#3b82f6; border-radius:50%; border:2px solid white; }
        .hidden { display:none!important }
        /* Simple banner mockup */
        .mock { min-height:120px; border-radius:12px; display:flex; align-items:center; justify-content:center; text-align:center; padding:12px; }
        .file-preview { max-height:120px; object-fit:contain; border-radius:8px; }
    </style>
</head>
<body class="antialiased">

<nav class="p-4 flex justify-between items-center bg-[#0f172a]/80 backdrop-blur-md sticky top-0 z-50 border-b border-white/5">
    <div class="flex items-center space-x-3">
        <img src="assets/logo.png" class="h-7 w-auto" alt="Zayn1x logo" onerror="this.src='https://img.icons8.com/color/48/1xbet.png'">
        <div class="text-lg font-black tracking-tight"><span class="text-blue-400">ZAYN1x</span> <span class="text-xs text-gray-400 font-medium">| Request Banner</span></div>
    </div>
    <div id="userBadge" class="hidden flex items-center space-x-2 bg-blue-500/8 px-3 py-1 rounded-full border border-blue-500/10 tg-only">
        <span id="topBarName" class="text-[11px] font-bold text-blue-300 uppercase tracking-tighter"></span>
    </div>
</nav>

<section class="hero-gradient pt-8 pb-6 px-6 text-center">
    <h1 class="animate__animated animate__fadeInDown text-2xl font-extrabold mb-2 bg-clip-text text-transparent bg-gradient-to-r from-white via-blue-200 to-blue-500">
        Request a Custom Banner
    </h1>
    <p class="text-[12px] text-gray-400">Fill the form — we’ll design and return a banner with your link ready to post.</p>
</section>

<main class="px-4 pb-36">
    <div class="glass p-6 rounded-3xl shadow-xl border border-white/5 max-w-3xl mx-auto mt-6">
        <h3 class="text-xs font-bold mb-4 text-blue-300 uppercase tracking-widest">Banner Request Form</h3>

        <form id="bannerForm" class="space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                <div>
                    <label class="text-[11px] text-gray-300 uppercase font-bold">Affiliate</label>
                    <input id="affiliate" name="affiliate" class="mt-1 w-full rounded-xl p-3 bg-[#0b1220] border border-white/5 text-sm" placeholder="@username or Name" />
                </div>

                <div>
                    <label class="text-[11px] text-gray-300 uppercase font-bold">Banner Size</label>
                    <select id="size" name="size" class="mt-1 w-full rounded-xl p-3 bg-[#0b1220] border border-white/5 text-sm">
                        <option value="1200x628">1200x628 (Facebook/Telegram)</option>
                        <option value="1080x1080">1080x1080 (Instagram)</option>
                        <option value="1080x1920">1080x1920 (Stories / TikTok)</option>
                        <option value="728x90">728x90 (Leaderboard)</option>
                        <option value="custom">Custom (write below)</option>
                    </select>
                </div>
            </div>

            <div id="customSizeRow" class="hidden">
                <label class="text-[11px] text-gray-300 uppercase font-bold">Custom size (WxH in px)</label>
                <input id="customSize" class="mt-1 w-full rounded-xl p-3 bg-[#0b1220] border border-white/5 text-sm" placeholder="e.g. 940x418" />
            </div>

            <div>
                <label class="text-[11px] text-gray-300 uppercase font-bold">Select Style</label>
                <select id="style" class="mt-1 w-full rounded-xl p-3 bg-[#0b1220] border border-white/5 text-sm">
                    <option value="pro">Pro — Dark cinematic (default)</option>
                    <option value="clean">Clean — Minimal</option>
                    <option value="sport">Sport — Energetic</option>
                    <option value="custom">Custom — Notes below</option>
                </select>
            </div>

            <div>
                <label class="text-[11px] text-gray-300 uppercase font-bold">Landing / Affiliate Link URL</label>
                <input id="link" name="link" type="url" required class="mt-1 w-full rounded-xl p-3 bg-[#0b1220] border border-white/5 text-sm" placeholder="https://..." />
            </div>

            <div>
                <label class="text-[11px] text-gray-300 uppercase font-bold">Primary Text / Headline</label>
                <input id="headline" class="mt-1 w-full rounded-xl p-3 bg-[#0b1220] border border-white/5 text-sm" placeholder="Win big. Join now." />
            </div>

            <div>
                <label class="text-[11px] text-gray-300 uppercase font-bold">CTA Text</label>
                <input id="cta" class="mt-1 w-full rounded-xl p-3 bg-[#0b1220] border border-white/5 text-sm" placeholder="Sign up — Get bonus" />
            </div>

            <div>
                <label class="text-[11px] text-gray-300 uppercase font-bold">Upload Logo / Image (optional)</label>
                <input id="file" type="file" accept="image/*" class="mt-2 w-full text-sm" />
                <div id="previewWrap" class="mt-3 hidden">
                    <img id="previewImg" class="file-preview mx-auto" alt="preview" />
                </div>
            </div>

            <div>
                <label class="text-[11px] text-gray-300 uppercase font-bold">Extra Notes for Designer</label>
                <textarea id="notes" rows="3" class="mt-1 w-full rounded-xl p-3 bg-[#0b1220] border border-white/5 text-sm" placeholder="Colors, fonts, do not use red, emphasis on odds, etc."></textarea>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                <button id="previewBtn" type="button" class="py-3 rounded-2xl font-black uppercase text-sm glass">Preview</button>
                <button id="submitBtn" type="submit" class="py-3 rounded-2xl font-black uppercase text-sm bg-[#0088cc]">Submit Request</button>
                <button id="clearBtn" type="button" class="py-3 rounded-2xl font-black uppercase text-sm border border-white/6">Reset</button>
            </div>
        </form>

        <div id="result" class="mt-6 hidden">
            <h4 class="text-[11px] font-bold text-gray-300 uppercase">Preview & Post</h4>
            <div id="mockup" class="mock mt-3 glass border border-white/5">
                <div id="mockContent" class="w-full text-sm">
                    <div id="mockHeadline" class="font-black text-lg">Your headline here</div>
                    <div id="mockCTA" class="mt-2 font-bold text-[13px] uppercase">CTA</div>
                    <div id="mockLink" class="mt-3 text-xs text-gray-400">https://...</div>
                </div>
            </div>

            <div class="mt-4">
                <label class="text-[11px] text-gray-300 uppercase font-bold">Post text (copy/share)</label>
                <textarea id="postText" rows="4" class="mt-1 w-full rounded-xl p-3 bg-[#071022] border border-white/5 text-sm"></textarea>
                <div class="flex gap-2 mt-3">
                    <button id="copyPost" class="py-2 px-4 rounded-xl font-bold text-sm glass">Copy Post</button>
                    <button id="shareTG" class="py-2 px-4 rounded-xl font-bold text-sm bg-[#2ea0ff]">Share to Telegram</button>
                    <button id="downloadReq" class="py-2 px-4 rounded-xl font-bold text-sm border border-white/6">Download JSON</button>
                </div>
            </div>
        </div>

        <p id="hint" class="text-[11px] text-gray-500 mt-4 italic">Tip: If you open this inside Telegram, the form will send directly to the bot. Otherwise it falls back to a webhook.</p>
    </div>
</main>

<!-- fallback start button (non-telegram) -->
<script>
    const tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;
    const isTelegram = !!tg;
    const webhookURL = 'https://script.google.com/macros/s/AKfycbzSKZIoeE7dh1lmdx0ggmDQpFF3YrYKRll1Mdjl7D1gh0zuFXb5qh73MULXUYbY0XB1/exec'; // <-- replace with your server endpoint to receive POST requests

    // init
    if (isTelegram) {
        try { tg.ready?.(); tg.expand?.(); tg.setHeaderColor?.('#0f172a'); } catch(e){ console.warn(e) }
    } else {
        document.querySelectorAll('.tg-only').forEach(n => n.classList.add('hidden'));
    }

    // personalize
    if (isTelegram && tg.initDataUnsafe?.user) {
        const u = tg.initDataUnsafe.user;
        document.getElementById('topBarName').innerText = (u.first_name || '') + (u.username ? ' @'+u.username : '');
        document.getElementById('userBadge').classList.remove('hidden');
        const aff = document.getElementById('affiliate');
        if (aff && u.username) aff.value = '@' + u.username;
    }

    // UI refs
    const form = document.getElementById('bannerForm');
    const size = document.getElementById('size');
    const customRow = document.getElementById('customSizeRow');
    const customSize = document.getElementById('customSize');
    const previewBtn = document.getElementById('previewBtn');
    const submitBtn = document.getElementById('submitBtn');
    const clearBtn = document.getElementById('clearBtn');
    const result = document.getElementById('result');
    const mockHeadline = document.getElementById('mockHeadline');
    const mockCTA = document.getElementById('mockCTA');
    const mockLink = document.getElementById('mockLink');
    const postText = document.getElementById('postText');
    const copyPost = document.getElementById('copyPost');
    const shareTG = document.getElementById('shareTG');
    const previewWrap = document.getElementById('previewWrap');
    const previewImg = document.getElementById('previewImg');
    const fileInput = document.getElementById('file');
    const downloadReq = document.getElementById('downloadReq');

    size.addEventListener('change', e => {
        if (e.target.value === 'custom') customRow.classList.remove('hidden'); else customRow.classList.add('hidden');
    });

    fileInput.addEventListener('change', e => {
        const f = e.target.files?.[0];
        if (!f) { previewWrap.classList.add('hidden'); previewImg.src = ''; return; }
        const url = URL.createObjectURL(f);
        previewImg.src = url; previewWrap.classList.remove('hidden');
    });

    function buildPayload() {
        const payload = {
            type: 'banner_request',
            time: new Date().toISOString(),
            affiliate: document.getElementById('affiliate').value || null,
            size: (size.value === 'custom' ? (customSize.value || 'custom') : size.value),
            style: document.getElementById('style').value,
            link: document.getElementById('link').value,
            headline: document.getElementById('headline').value,
            cta: document.getElementById('cta').value,
            notes: document.getElementById('notes').value,
            // file is not sent as binary to telegram via sendData; we send a filename and base64 when possible
            fileName: fileInput.files?.[0]?.name || null,
        };
        return payload;
    }

    previewBtn.onclick = () => {
        const p = buildPayload();
        mockHeadline.innerText = p.headline || 'Your headline here';
        mockCTA.innerText = p.cta || 'Play Now';
        mockLink.innerText = p.link || 'https://your.aff.link';
        postText.value = `${p.headline || ''}\n${p.cta ? p.cta + ' → ' : ''}${p.link}\n\nPosted by ${p.affiliate || 'ZAYN1x'}`.trim();
        result.classList.remove('hidden');
    };

    copyPost.onclick = async () => {
        try { await navigator.clipboard.writeText(postText.value); copyPost.innerText = 'Copied!'; setTimeout(()=>copyPost.innerText='Copy Post',1400); }
        catch(e){ alert('Copy failed — please copy manually.'); }
    };

    shareTG.onclick = () => {
        const text = encodeURIComponent(postText.value);
        const url = encodeURIComponent(document.getElementById('link').value || 'https://t.me/zayn1xaffiliates');
        const share = `https://t.me/share/url?url=${url}&text=${text}`;
        if (isTelegram && typeof tg.openLink === 'function') {
            try { tg.openLink(share); return; } catch(e) { /* fallback */ }
        }
        window.open(share, '_blank', 'noopener,noreferrer');
    };

    downloadReq.onclick = () => {
        const p = buildPayload();
        const blob = new Blob([JSON.stringify(p, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); a.href = url; a.download = 'banner-request.json'; a.click(); URL.revokeObjectURL(url);
    };

    clearBtn.onclick = () => { form.reset(); previewWrap.classList.add('hidden'); result.classList.add('hidden'); }

    form.addEventListener('submit', async e => {
        e.preventDefault();
        submitBtn.disabled = true; submitBtn.innerText = 'Sending...';

        const payload = buildPayload();

        // try to include small image as base64 if file present and < 1MB
        if (fileInput.files?.[0]) {
            const f = fileInput.files[0];
            if (f.size < 1024*1024) {
                payload.fileBase64 = await toBase64(f);
            } else {
                payload.fileNote = 'File too large for inline; will be available separately.';
            }
        }

        // If inside Telegram WebApp, use tg.sendData to deliver to bot (Bot gets web_app_data)
        try {
            if (isTelegram && typeof tg.sendData === 'function') {
                tg.sendData(JSON.stringify(payload));
                showToast('Request sent to bot — designer will reply in channel.');
                submitBtn.innerText = 'Sent';
                setTimeout(()=>{ submitBtn.disabled=false; submitBtn.innerText='Submit Request'; }, 1200);
                return;
            }
        } catch (err) { console.warn('tg.sendData failed', err); }

        // Fallback: POST to webhook
        try {
            const r = await fetch(webhookURL, { method:'POST', headers:{'content-type':'application/json'}, body: JSON.stringify(payload) });
            if (r.ok) {
                showToast('Request submitted to webhook.');
                submitBtn.innerText='Sent';
            } else {
                showToast('Webhook error: ' + r.status);
                submitBtn.innerText='Error';
            }
        } catch (err) {
            console.error(err);
            showToast('Network error while sending. See console.');
            submitBtn.innerText='Failed';
        }
        setTimeout(()=>{ submitBtn.disabled=false; submitBtn.innerText='Submit Request'; }, 1600);
    });

    function showToast(msg) {
        const t = document.createElement('div');
        t.innerText = msg; t.className = 'fixed bottom-6 left-1/2 transform -translate-x-1/2 bg-white/10 text-white py-2 px-4 rounded-xl shadow-lg';
        document.body.appendChild(t);
        setTimeout(()=>{ t.style.opacity=0; setTimeout(()=>t.remove(),300); }, 2200);
    }

    function toBase64(file) {
        return new Promise((res, rej) => {
            const reader = new FileReader(); reader.onload = () => res(reader.result.split(',')[1]); reader.onerror = rej; reader.readAsDataURL(file);
        });
    }

    // Accessibility: allow pressing Enter on form (already handled by submit)
</script>

</body>
</html>
